(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/public/chat/shopro/index"],{"1c98":function(t,e,s){"use strict";s.d(e,"b",(function(){return o})),s.d(e,"c",(function(){return a})),s.d(e,"a",(function(){return i}));var i={shoproNavbar:function(){return s.e("components/shopro-navbar/shopro-navbar").then(s.bind(null,"9733"))},uNoticeBar:function(){return s.e("node-modules/uview-ui/components/u-notice-bar/u-notice-bar").then(s.bind(null,"9ca4"))},uLoadmore:function(){return s.e("node-modules/uview-ui/components/u-loadmore/u-loadmore").then(s.bind(null,"417c"))},uParse:function(){return Promise.all([s.e("common/vendor"),s.e("node-modules/uview-ui/components/u-parse/u-parse")]).then(s.bind(null,"bc80"))},uUpload:function(){return Promise.all([s.e("common/vendor"),s.e("node-modules/uview-ui/components/u-upload/u-upload")]).then(s.bind(null,"46f9"))}},o=function(){var t=this,e=t.$createElement,s=(t._self._c,t.navTitle.split(",")),i=t.navTitle.split(","),o=t.navTitle.split(","),a=t.logmsgList.length,n=t.__map(t.chatList,(function(e,s){var i=t.__get_orig(e),o=t.showTime(e.date,s)&&"system"!==e.type&&"template"!==e.type,a=o?t.$u.timeFrom(e.date):null;return{$orig:i,m0:o,g4:a}})),r=t.showLogBox?t.__map(t.orderList,(function(e,s){var i=t.__get_orig(e),o="order"===t.cardType?t.$u.timeFormat(e.createtime,"mm-dd hh:MM"):null;return{$orig:i,g5:o}})):null;t.$mp.data=Object.assign({},{$root:{g0:s,g1:i,g2:o,g3:a,l0:n,l1:r}})},a=[]},"1eb4":function(t,e,s){},a1d0:function(t,e,s){"use strict";s.r(e);var i=s("f630"),o=s.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},c689:function(t,e,s){"use strict";s.r(e);var i=s("1c98"),o=s("a1d0");for(var a in o)["default"].indexOf(a)<0&&function(t){s.d(e,t,(function(){return o[t]}))}(a);s("ca1e");var n=s("828b"),r=Object(n["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=r.exports},ca1e:function(t,e,s){"use strict";var i=s("1eb4"),o=s.n(i);o.a},f630:function(t,e,s){"use strict";(function(t){var i=s("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(s("7eb4")),a=i(s("af34")),n=i(s("3b2d")),r=i(s("ee10")),c=i(s("7ca3")),u=i(s("60bb")),d=s("e703"),l=s("8f59");function h(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function g(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?h(Object(s),!0).forEach((function(e){(0,c.default)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):h(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var m={data:function(){return{socket:null,InputBottom:0,isPageHide:!1,HTTP_API_URL:d.API_URL,EMOJI_BASE_URL:d.BASE_URL,navTitle:"连接中...",scrollInto:"",lastId:"",logmsgList:[],templateList:[],emojiList:[],newEmojiList:[],loadText:{loadmore:"点击加载更多",loading:"正在加载，请喝杯茶...",nomore:"我也是有底线的"},logStatus:"loadmore",cardType:"",currentPage:1,lastPage:1,chatList:[],msgText:"",showNotice:!0,noticeType:"warning",showTools:!1,showLogBox:!1,showEmoji:!1,logTitle:"",toolsList:[{id:"imgs",image:this.$IMG_URL+"/imgs/chat/imgs_icon.png",title:"图片"},{id:"goods",image:this.$IMG_URL+"/imgs/chat/goods_icon.png",title:"商品"},{id:"order",image:this.$IMG_URL+"/imgs/chat/order_icon.png",title:"订单"},{id:"file",image:this.$IMG_URL+"/imgs/chat/file_icon.png",title:"文件"}],noticeList:[],loadStatus:"loadmore",orderList:[],viewList:[],orderCurrentPage:1,viewCurrentPage:1,orderTotalPage:1,viewTotalPage:1,token:t.getStorageSync("sh_token")}},computed:g(g({},(0,l.mapGetters)(["userInfo"])),{},{isFocus:function(){var t=!1;return t=!!this.msgText,t},isClose:function(){if(this.socket)return this.socket.isClose}}),created:function(){this.init()},onShow:function(){this.init(),this.isPageHide=!0},onHide:function(){this.isPageHide&&this.socket.close(),t.hideKeyboard()},beforeDestroy:function(){this.socket.close()},methods:{init:function(){var t=this,e=this;e.$http("common.chat").then((function(s){1==s.code&&(e.noticeList.push(s.data.config.basic.notice),e.templateList=s.data.question,e.emojiList=s.data.emoji,e.newEmojiList=t.sortData(s.data.emoji,30),e.socket=new u.default({ping:2e4,is_ssl:s.data.config.system.is_ssl,gateway_port:s.data.config.system.gateway_port,ssl_type:s.data.config.system.ssl_type},(function(t){e.parseMsgStatus(t.data)})))}))},sortData:function(t,e){var s=[],i=[];return t.forEach((function(t){i.length===e&&(i=[]),0===i.length&&s.push(i),i.push(t)})),s},showTime:function(t,e){t=parseInt(t),10==t.toString().length&&(t*=1e3);var s=(new Date).getTime()-t;if(s=parseInt(s/1e3),e%6==0&&s>=300)return!0},jump:function(t,e){this.$Router.push({path:t,query:e})},parseMsgStatus:function(e){var s,i,o=this,a=JSON.parse(e),n="客服";if(null!==(s=a.data)&&void 0!==s&&s.customer_service&&(n=a.data.customer_service.name?"客服-".concat(a.data.customer_service.name):"客服"),1===a.code)switch(a.type){case"init":t.setStorageSync("chatSessionId",a.data.session_id),this.chatLog().then(this.pushChat("","template")),this.goBottom();break;case"waiting":this.navTitle="暂无客服在线",this.pushChat(a.data.message.message,"system");break;case"access":this.navTitle="".concat(n,",在线"),this.pushChat(a.data.message.message,"system");break;case"customer_service_online":this.navTitle="".concat(n,",在线");break;case"customer_service_offline":this.navTitle="".concat(n,",离线");break;case"message":this.chatList.push(this.parseMsg(a.data.message,a.data.message.identify)),this.goBottom(),t.vibrateLong();break;case"message_list":var r=a.data.message_list.data;this.logmsgList=a.data.message_list.data,this.lastId=null===(i=r[0])||void 0===i?void 0:i.id,this.lastPage=a.data.message_list.last_page,r.forEach((function(t){o.chatList.unshift(o.parseMsg(t,t.identify))}));break;default:}else this.$u.toast("连接错误，正在重试~")},parseMsg:function(t,e){var s=null;switch(t.message_type){case"system":s={identify:"customer_service",type:"system",msg:t.message};break;case"image":s={identify:t.sender_identify,type:"text",msg:'<img class="chat-img" src="'.concat(t.message,'"/>'),server_avatar:null===e||void 0===e?void 0:e.avatar,date:t.createtime};break;case"goods":s={identify:t.sender_identify,type:t.message_type,msg:JSON.parse(t.message),server_avatar:null===e||void 0===e?void 0:e.avatar,date:t.createtime};break;case"order":s={identify:t.sender_identify,type:t.message_type,msg:JSON.parse(t.message),server_avatar:null===e||void 0===e?void 0:e.avatar,date:t.createtime};break;case"text":s={identify:t.sender_identify,type:t.message_type,msg:this.replaceEmoji(t.message),server_avatar:null===e||void 0===e?void 0:e.avatar,date:t.createtime};break;default:break}return s},chatLog:function(){var t=this;return(0,r.default)(o.default.mark((function e(){var s,i,a;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={identify:"user",type:"message_list",data:{page:t.currentPage,last_id:t.lastId}},t.logStatus="loading",i=JSON.stringify(s),e.next=5,t.socket.send(i);case 5:a=e.sent,a&&"sendSocketMessage:ok"===a.errMsg&&setTimeout((function(){t.logStatus="loadmore"}),300);case 7:case"end":return e.stop()}}),e)})))()},InputFocus:function(t){this.onMask()},InputBlur:function(t){this.InputBottom=0},onInput:function(t){},logLoadmore:function(){this.currentPage<this.lastPage?(this.currentPage+=1,this.chatLog()):this.logStatus="nomore"},onTools:function(){if(this.isClose)return this.$u.toast("您已掉线！请返回重试"),this.noticeType="error",void(this.noticeList=["您已掉线！请返回重试"]);this.showEmoji=!1,this.showTools=!this.showTools},onToolItem:function(t){var e=this;this.orderList=[],this.viewList=[],this.orderCurrentPage=1,this.viewCurrentPage=1,this.orderTotalPage=1,this.viewTotalPage=1,this.cardType=t;var s=new Map;s.set("order",(function(){e.logTitle="我的订单",e.showLogBox=!0,e.getOrderList()})),s.set("goods",(function(){e.logTitle="我的浏览",e.showLogBox=!0,e.getbrowseList()})),s.set("imgs",this.chooseImg),s.get(t)()},onViewCard:function(t){var e={id:t.goods.id,title:t.goods.title,price:t.goods.price,image:t.goods.image},s=JSON.stringify(e);this.sendWs(s,"goods"),this.pushChat(e,"goods"),this.onMask()},onOrderCard:function(t){var e={id:t.id,title:t.item[0].goods_title,price:t.item[0].goods_price,num:t.item[0].goods_num,order_sn:t.order_sn,image:t.item[0].goods_image,status_name:t.status_name},s=JSON.stringify(e);this.sendWs(s,"order"),this.pushChat(e,"order"),this.onMask()},closeToolsItem:function(){this.showLogBox=!1},selEmoji:function(){this.showTools=!1,this.showLogBox=!1,this.showEmoji=!this.showEmoji},onEmoji:function(t){this.msgText+=t.name},onMask:function(){this.showTools=!1,this.showLogBox=!1,this.showEmoji=!1},closeNotice:function(){this.showNotice=!1},goBottom:function(){var t=this,e=null;this.scrollInto="",clearTimeout(e),e=setTimeout((function(){t.scrollInto="scrollBottom"}),300)},uploadSuccess:function(t){var e=this;t.forEach((function(t){e.sendWs(t.response.data.url,"image"),e.pushChat('<img class="chat-img" src="'.concat(t.response.data.fullurl,'"/>')),e.onMask()}))},uploadChange:function(t){},onQuestion:function(t){var e=this;return(0,r.default)(o.default.mark((function s(){var i,a;return o.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return e.pushChat(t.title),i={identify:"user",type:"message",message:{message_type:"text",message:t.title},data:{question_id:t.id}},a=JSON.stringify(i),s.next=5,e.socket.send(a);case 5:s.sent;case 6:case"end":return s.stop()}}),s)})))()},onSend:function(){this.msgText&&(this.sendWs(this.msgText),this.pushChat(this.msgText),this.msgText=""),this.showEmoji&&this.onMask()},sendWs:function(t){var e=arguments,s=this;return(0,r.default)(o.default.mark((function i(){var a,n,r;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=e.length>1&&void 0!==e[1]?e[1]:"text",n={identify:"user",type:"message",message:{message_type:a,message:t}},r=JSON.stringify(n),i.next=5,s.socket.send(r);case 5:i.sent;case 6:case"end":return i.stop()}}),i)})))()},pushChat:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(this.isClose)return this.$u.toast("您已掉线！请返回重试"),this.noticeType="error",void(this.noticeList=["您已掉线！请返回重试"]);this.chatList.push({identify:"user",type:e,msg:this.replaceEmoji(t),date:(new Date).getTime()}),this.goBottom()},selEmojiFile:function(t){for(var e in this.emojiList)if(this.emojiList[e].name===t)return this.emojiList[e].file;return!1},replaceEmoji:function(t){var e=this,s=t;if("object"!==(0,n.default)(s)){var i=s.match(/\[(.+?)\]/g);i&&i.forEach((function(t){var i=e.selEmojiFile(t);s=s.replace(t,'<img class="chat-img" style="width:50rpx;height:50rpx;margin:0 6rpx" src="'.concat(e.EMOJI_BASE_URL,"/assets/addons/shopro/img/emoji/").concat(i,'"/>'))}))}return s},loadMore:function(){"goods"===this.cardType&&this.viewCurrentPage<this.viewTotalPage&&(this.viewCurrentPage+=1,this.getbrowseList()),"order"===this.cardType&&this.orderCurrentPage<this.orderTotalPage&&(this.orderCurrentPage+=1,this.getOrderList())},getOrderList:function(){var t=this;t.isLoading=!0,t.loadStatus="loading",t.$http("order.index",{type:"all",page:t.orderCurrentPage}).then((function(e){t.isLoading=!1,1===e.code&&(t.orderList=[].concat((0,a.default)(t.orderList),(0,a.default)(e.data.data)),t.orderTotalPage=e.data.last_page,t.loadStatus=t.orderCurrentPage<e.data.last_page?"loadmore":"nomore")}))},getbrowseList:function(){var t=this;t.loadStatus="loading",t.$http("user.viewList",{page:t.viewCurrentPage}).then((function(e){1===e.code&&(t.viewList=[].concat((0,a.default)(t.viewList),(0,a.default)(e.data.data)),t.viewTotalPage=e.data.last_page,t.loadStatus=t.viewCurrentPage<e.data.last_page?"loadmore":"nomore")}))}}};e.default=m}).call(this,s("df3c")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/public/chat/shopro/index-create-component',
    {
        'pages/public/chat/shopro/index-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('df3c')['createComponent'](__webpack_require__("c689"))
        })
    },
    [['pages/public/chat/shopro/index-create-component']]
]);
