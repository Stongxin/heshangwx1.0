(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/pray/components/to_blessing/to_blessing"],{"17fc":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={uniCalendar:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-calendar/components/uni-calendar/uni-calendar")]).then(n.bind(null,"0e6b"))},uniDataPicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker")]).then(n.bind(null,"5264"))},uPopup:function(){return n.e("node-modules/uview-ui/components/u-popup/u-popup").then(n.bind(null,"e07b"))},uTabs:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-tabs/u-tabs")]).then(n.bind(null,"5cc0"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.coverImage?e.$common.disposeSrc(e.coverImage):null),i=[47,61,62].indexOf(Number(e.formState.content_id))>-1&&e.people_num>0,a=i?e.__map(e.formState.service_object,(function(t,n){var i=e.__get_orig(t),a=61!=e.formState.content_id?[47,62].indexOf(Number(e.formState.content_id))>-1&&e.serviceObjectList.length>0:null;return{$orig:i,g2:a}})):null,o="blessing"==e.formState.type?e.__map(e.blessing_language_str,(function(t,n){var i=e.__get_orig(t),a=e.formState.sentiment.indexOf(t);return{$orig:i,g3:a}})):null;e._isMounted||(e.e0=function(t){e.placePicker=!1},e.e1=function(t){e.popupShow=!1}),e.$mp.data=Object.assign({},{$root:{g0:n,g1:i,l0:a,l1:o}})},o=[]},"29af5":function(e,t,n){"use strict";var i=n("cde7"),a=n.n(i);a.a},"41ca":function(e,t,n){"use strict";n.r(t);var i=n("17fc"),a=n("b2da");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("29af5");var s=n("828b"),r=Object(s["a"])(a["default"],i["b"],i["c"],!1,null,"6ffc180e",null,!1,i["a"],void 0);t["default"]=r.exports},"7e26":function(e,t,n){"use strict";(function(e){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n("7ca3")),o=n("9a4d"),s={components:{},data:function(){var t;return{coverImage:"",formState:(t={temple_id:e.getStorageSync("temple_id"),type:"",card_id:"",content_id:"",name:"",mobile:"",service_object:[{name:"",nickname:"",isCustom:!1}],yang_name:[{name:""}],put_time:"",sentiment:[],location:"",source:"wxxcx",equipment_code:"0",openid:e.getStorageSync("openid"),pay_type:"wechat",location_id:"",location_address:"",place_id:"0",address:"",one_year:"0",year:"",lunar_date:[{start:"",end:""}],male_date:[{start:"",end:""}]},(0,a.default)(t,"place_id",""),(0,a.default)(t,"place_number",""),t),dataList:[],dateIndex:"",dateKey:"",dataType:"",tabletPlace:[],foTypeList:[],urlOptions:{},yang_number:"",people_num:"",serviceObjectIndex:0,serviceObjectList:[],yearList:[],blessing_language_str:[],verifyNickname:!1,rules:[{key:"name",message:"请填写登记人"},{key:"mobile",message:"请输入联系方式"},{key:"address",message:"请输入地址"}],popupShow:!1,orderDetail:{},mobile:e.getStorageSync("mobile")||"",regionList:o,region:"",locationList:[],isEquipment:!0,placePicker:!1,placeTabsList:[{name:"东"},{name:"南"},{name:"西"},{name:"北"}],placeTabsCurrent:0,placeList:{},active_tablet:"",other_buddha:!1,startDate:"",foshiItem:{}}},created:function(){this.startDate=this.$common.formatDate(new Date,"YYYY-MM-DD");var t=getCurrentPages(),n=t[t.length-1].options;if(n.scene){var i=n.scene.split("_");this.urlOptions={id:i[1],column_type:i[2],buddhist_id:i[3]}}else this.urlOptions={id:n.column_id,column_type:n.column_type,buddhist_id:n.buddhist_id};this.formState.type=this.urlOptions.column_type,this.formState.card_id=this.urlOptions.buddhist_id,this.getYears(),this.getBlessingInfo(),e.getStorageSync("location_id")&&e.getStorageSync("place_id")?(this.isEquipment=!0,this.formState.location_id=e.getStorageSync("location_id"),this.formState.place_id=e.getStorageSync("place_id"),this.formState.location="1-"+e.getStorageSync("location_id"),this.getFoType()):(this.isEquipment=!1,this.getMeritTypeList())},computed:{days:function(){var e=0;for(var t in this.formState.male_date){var n=this.formState.male_date[t];""!=n.start&&""!=n.end&&(e+=this.diffDays(n.start,n.end))}return e},totalPrice:function(){var e=0;return e=1==this.formState.location_id?this.foshiItem.one_year_price:this.days*this.foshiItem.price,e}},watch:{"formState.location_id":{handler:function(e){this.isEquipment||(this.getFoType(),this.formState.place_id="",this.formState.place_number="")},deep:!0,immediate:!0}},methods:{diffDays:function(e,t){var n=new Date(e).getTime(),i=new Date(t).getTime(),a=Math.abs(n-i);return Math.floor(a/864e5)+1},getPhoneNumber:function(t){var n=this;t.detail.code&&this.$request({url:"user/WxXxLogin",data:{openid:e.getStorageSync("openid"),code:t.detail.code,temple_id:e.getStorageSync("temple_id")}}).then((function(t){e.setStorageSync("token",t.token),e.setStorageSync("mobile",t.mobile),n.formState.mobile=t.mobile}))},submit:function(){var t=this,n=JSON.parse(JSON.stringify(this.formState));if(n.male_date.length>0&&(n.male_date=n.male_date.map((function(e){if(""!=e.start&&""!=e.end)return e.start+"*"+e.end})).join(",")),n.lunar_date.length>0&&(n.lunar_date=n.lunar_date.map((function(e){if(""!=e.start&&""!=e.end)return e.start+"*"+e.end})).join(",")),n.service_object=n.service_object.map((function(e){if(61==n.content_id&&(e.nickname="氏门宗"),t.verifyNickname){if(""==e.name||""==e.nickname)return}else if(""==e.name)return;return"".concat(e.name,"-").concat(e.nickname)})).join(","),n.sentiment=n.sentiment.join(","),n.yang_name=n.yang_name.map((function(e){if(""!=e.name)return e.name})).join(","),1!=n.one_year||""!=n.year)if(0!=n.one_year||""!=n.male_date)if(""==n.yang_name&&this.yang_number>0)e.showToast({title:"请完善阳上姓名信息",icon:"none",mask:!0});else{for(var i in this.rules){var a=this.rules[i].key;if(""==n[a])return void e.showToast({title:this.rules[i].message,icon:"none",mask:!0})}"to"==n.type&&""==n.service_object&&this.people_num>0?e.showToast({title:"请完善佛光接引信息",icon:"none",mask:!0}):this.other_buddha&&""==n.place_id?e.showToast({title:"请选择牌位位置",icon:"none",mask:!0}):"blessing"!=n.type||""!=n.sentiment?""!=this.region?(n.address=this.region.split("-").join("")+n.address,e.login({provider:"weixin",success:function(i){t.$request({url:"onLogin",version:"/vx/",method:"GET",data:{code:i.code,temple_id:e.getStorageSync("temple_id")}}).then((function(i){e.setStorageSync("openid",i.openid),t.$request({url:"user/WxXxOpendiLogin",data:{openid:i.openid}}).then((function(i){e.setStorageSync("token",i.token),e.setStorageSync("mobile",i.mobile),t.mobile=i.mobile,t.$request({url:"buddhist/blessingOrder",data:n,header:{token:e.getStorageSync("token")}},!0).then((function(e){t.popupShow=!0,t.orderDetail=e}))}))}))}})):e.showToast({title:"请选择省市区",icon:"none",mask:!0}):e.showToast({title:"请选择祈福语",icon:"none",mask:!0})}else e.showToast({title:"请选择佛事日期",icon:"none",mask:!0});else e.showToast({title:"请选择年份",icon:"none",mask:!0})},payment:function(){var t=this;e.requestPayment({provider:"wxpay",timeStamp:this.orderDetail.miniPayRequest.timeStamp,nonceStr:this.orderDetail.miniPayRequest.nonceStr,package:this.orderDetail.miniPayRequest.package,signType:this.orderDetail.miniPayRequest.signType,paySign:this.orderDetail.miniPayRequest.paySign,success:function(n){e.redirectTo({url:"/pages/hisOrder/orderDetail?result=true&showImg=true&order_id=".concat(t.orderDetail.merOrderId)}),console.log("支付成功",n)},fail:function(t){e.showToast({title:"支付失败",icon:"error",mask:!0}),console.log("支付失败",t)}})},getMeritTypeList:function(){var e=this;this.$request({url:"temple/tabletPlace/".concat(this.formState.temple_id),method:"GET"}).then((function(t){e.tabletPlace=t,e.formState.location_id=t[0].id,e.formState.location_address=t[0].name,e.formState.location=t[0].name+"-"+t[0].id,e.formState.one_year=t[0].one_year}))},getFoType:function(){var e=this;this.$request({url:"temple/foType",method:"GET",isTransformResponse:!0,data:{temid:this.formState.temple_id,location_id:this.formState.location_id,type:this.urlOptions.column_type}}).then((function(t){e.foTypeList=t.data,e.selectType(t.data[0]),e.other_buddha=t.other.buddha,t.other.buddha&&e.getMemorialTabletType()}))},getMemorialTabletType:function(){var e=this;this.$request({url:"temple/memorialTabletType",method:"GET",data:{location_id:this.formState.location_id,background_color:"blessing"==this.formState.type?"red":"yellow"}},!0).then((function(t){e.placeTabsList=t}))},getMemorialTabletList:function(){var e=this;this.$request({url:"temple/memorialTabletList",method:"POST",data:{location_id:this.formState.location_id,background_color:"blessing"==this.formState.type?"red":"yellow",put_name:this.placeTabsList[this.placeTabsCurrent].put_name,years:1==this.formState.one_year?"y":"n",years_date:1==this.formState.one_year?this.formState.year:"",times:1==this.formState.one_year?"[]":JSON.stringify(this.formState.male_date)}},!0).then((function(t){e.placeList=t}))},getYears:function(){for(var e=(new Date).getFullYear(),t=e;t<=e+20;t++)this.yearList.push({text:t,value:t})},getBlessingInfo:function(){var e=this;this.$request({url:"buddhist/blessingInfo/".concat(this.formState.temple_id,"/").concat(this.urlOptions.column_type),method:"GET"}).then((function(t){e.blessing_language_str=t.info.blessing_language_str,e.coverImage=t.info.image}))},openLocationPicker:function(){this.$refs.locationPicker.show()},openPlacePicker:function(){var t=JSON.parse(JSON.stringify(this.formState));t.male_date.length>0&&(t.male_date=t.male_date.map((function(e){if(""!=e.start&&""!=e.end)return e.start+"*"+e.end})).join(",")),1!=t.one_year||""!=t.year?0!=t.one_year||""!=t.male_date?(this.placePicker=!0,this.getMemorialTabletList()):e.showToast({title:"请先选择佛事日期",icon:"none"}):e.showToast({title:"请先选择年份",icon:"none"})},openAreaPicker:function(){this.$refs.areaPicker.show()},confirmRegion:function(e){this.region=e.detail.value.map((function(e){return e.text})).join("-")},selectType:function(e){if(this.foshiItem=e,this.yang_number=e.yang_number,this.formState.content_id=e.type_id,this.formState.yang_name.length>this.yang_number&&(this.formState.yang_name=this.formState.yang_name.slice(0,this.yang_number)),this.formState.service_object=[{name:"",nickname:"",isCustom:!1}],[47,61,62].indexOf(Number(e.type_id))>-1){if(this.people_num=e.people_num,""==e.diyname)return this.serviceObjectList=[],void(this.verifyNickname=!1);var t=e.diyname.split(",").map((function(e){return{text:e,value:e}}));t.push({text:"自定义",value:"自定义"}),this.verifyNickname=!0,this.serviceObjectList=t}},addName:function(){this.formState.yang_name.length!=this.yang_number?this.formState.yang_name.push({name:""}):e.showToast({title:"最多允许添加(".concat(this.yang_number,")人"),icon:"none",mask:!0})},delName:function(t){1!=this.formState.yang_name.length?this.formState.yang_name.splice(t,1):e.showToast({title:"最少需完善(1)人",icon:"none",mask:!0})},addAppellation:function(){this.formState.service_object.length!=this.people_num?this.formState.service_object.push({name:"",nickname:"",isCustom:!1}):e.showToast({title:"最多允许添加(".concat(this.people_num,")人"),icon:"none",mask:!0})},delAppellation:function(t){1!=this.formState.service_object.length?this.formState.service_object.splice(t,1):e.showToast({title:"最少需完善(1)人",icon:"none",mask:!0})},confirmLocation:function(e){console.log(e,3333);var t=e.detail.value[0];this.formState.location_address=t.text,this.formState.location=t.text+"-"+t.value,this.formState.one_year=t.one_year},confirmPlace:function(e){this.formState.place_id=e.id,this.formState.place_number=e.location_number,this.placePicker=!1},getLocation:function(){var e=this;this.$request({url:"temple/location",method:"GET",data:{location_id:this.formState.location_id,type:"location",colortype:"blessing"==this.formState.type?0:1}}).then((function(t){e.locationList=t.location_number}))},selectSentiment:function(e){var t=this.formState.sentiment.indexOf(e);-1==t?this.formState.sentiment.push(e):this.formState.sentiment.splice(t,1)},openNamePciker:function(e){this.serviceObjectIndex=e,this.$refs.namePicker.show()},openYearPicker:function(){this.$refs.yearPicker.show()},confirmYear:function(e){console.log(e)},confirmAppellation:function(e){var t=e.detail.value[0].value;"自定义"==t?(this.formState.service_object[this.serviceObjectIndex].isCustom=!0,this.formState.service_object[this.serviceObjectIndex].nickname=""):(this.formState.service_object[this.serviceObjectIndex].isCustom=!1,this.formState.service_object[this.serviceObjectIndex].nickname=t)},confirmCalendar:function(e){var t=this;this.formState.put_time=e.range.data.length,this.$set(this.formState.male_date[this.dateIndex],"start",e.range.before),this.$set(this.formState.male_date[this.dateIndex],"end",e.range.after),this.$request({url:"common/lunarDate/".concat(e.range.before),method:"GET"}).then((function(e){t.formState.lunar_date[t.dateIndex].start=e[0]})),this.$request({url:"common/lunarDate/".concat(e.range.after),method:"GET"}).then((function(e){t.formState.lunar_date[t.dateIndex].end=e[0]}))},openCalendar:function(e,t,n){this.$refs.calendar.open(),this.dataType=e,this.dateIndex=n,this.dateKey=t},addDate:function(e){this.formState.lunar_date.push({start:"",end:""}),this.formState.male_date.push({start:"",end:""})},delDate:function(t){1!=this.formState.lunar_date.length?(this.formState.lunar_date.splice(t,1),this.formState.male_date.splice(t,1)):e.showToast({title:"最少需添加一条",icon:"none",mask:!0})},placeTabsChange:function(e){this.placeTabsCurrent=e,this.getMemorialTabletList()}}};t.default=s}).call(this,n("df3c")["default"])},b2da:function(e,t,n){"use strict";n.r(t);var i=n("7e26"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},cde7:function(e,t,n){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/pray/components/to_blessing/to_blessing-create-component',
    {
        'pages/pray/components/to_blessing/to_blessing-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('df3c')['createComponent'](__webpack_require__("41ca"))
        })
    },
    [['pages/pray/components/to_blessing/to_blessing-create-component']]
]);
