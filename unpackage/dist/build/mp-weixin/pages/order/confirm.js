(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/confirm"],{"153d":function(e,t,o){"use strict";(function(e){var r=o("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(o("7eb4")),i=r(o("ee10")),s=r(o("7ca3")),c=o("8f59"),u=r(o("a25c"));function a(e,t){var o="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return d(e,t)}(e))||t&&e&&"number"===typeof e.length){o&&(e=o);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==o.return||o.return()}finally{if(c)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function p(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?p(Object(o),!0).forEach((function(t){(0,s.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var l={components:{shSelectCoupon:function(){o.e("pages/order/components/sh-select-coupon").then(function(){return resolve(o("4c17"))}.bind(null,o)).catch(o.oe)}},data:function(){var e=this;return{platform:this.$platform.get(),totalNum:0,couponList:[],addressData:{},addressId:0,customStyle:{width:"210rpx",lineHeight:"70rpx",background:"linear-gradient(90deg, rgba(233, 180, 97, 1), rgba(238, 204, 137, 1))",boxShadow:" 0px 7rpx 6rpx 0px rgba(229, 138, 0, 0.22)",borderRadius:"100rpx",fontSize:"28rpx",border:"none",color:"#fff",margin:"0"},isDisabled:!1,showCheckTime:!1,checkTime:{},showExpressType:!1,expressTypeMap:{express:"物流快递",selfetch:"到店/自提",store:"商家配送",autosend:"自动发货"},expressType:[{id:"e1",title:"物流快递",value:"express"},{id:"e2",title:"到店/自提",value:"selfetch"},{id:"e3",title:"商家配送",value:"store"},{id:"e4",title:"自动发货",value:"autosend"}],storeList:[],storeInfo:{id:0,name:"",dispatch_text:""},from:"",orderType:"",grouponBuyType:"alone",grouponId:0,goodsList:[],perGoodsList:{},currentGoodsId:0,currentSkuId:0,remark:"",orderPre:{},couponId:0,couponPrice:"选择优惠券",expressTypeCur:"",inExpressType:[],isProtocol:!0,selfPhone:"",getFocus:!1,checkType:"自提",checkTimeCur:0,checkTimeId:"c1",checkDayCur:0,lat:0,lng:0,showInvoice:!1,invoiceType:"person",selectedInvoice:"不开具发票",invoiceForm:{model:{header_name:"",mobile:"",tax_no:"",type:"person"},rules:{mobile:[{required:!0,message:"请输入手机号",trigger:["change","blur"]},{validator:function(t,o,r){return e.$u.test.mobile(o)},message:"手机号码不正确",trigger:["change","blur"]}],header_name:[{required:!0,message:"请填写名称",trigger:["change","blur"]}]}}}},computed:h(h({},(0,c.mapGetters)(["initStore"])),{},{expressClass:function(){var e="head-nav--active",t=this.expressType,o=this.expressTypeCur;return 0===o&&(e="head-nav__left--active"),o===t.length-1&&(e="head-nav__right--active"),e},hasCoupons:function(){return!(!this.couponList.length||this.orderPre.activity_type)||Boolean(this.couponList.length&&this.orderPre.activity_type&&-1===this.orderPre.activity_type.indexOf("groupon")&&-1===this.orderPre.activity_type.indexOf("seckill")&&"score"!==this.orderType)}}),onShow:function(){var t=this;e.$once("SELECT_STORE",(function(e){t.storeInfo=JSON.parse(e.storeInfo)})),e.$on("SELECT_ADDRESS",(function(o){o.addressData?(t.addressData=JSON.parse(o.addressData),t.addressId=t.addressData.id):t.addressId=0,t.getPre(),o.addressData&&e.$off("SELECT_ADDRESS")}))},onLoad:function(){var e=this;return(0,i.default)(n.default.mark((function t(){return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.goodsList=e.$Route.query.goodsList,e.from=e.$Route.query.from,e.orderType=e.$Route.query.orderType,e.grouponBuyType=e.$Route.query.grouponBuyType,e.grouponId=e.$Route.query.grouponId,t.next=7,e.init();case 7:case"end":return t.stop()}}),t)})))()},methods:h(h({},(0,c.mapActions)(["getCartList"])),{},{changeInvoiceType:function(e){this.invoiceType=e,this.invoiceForm.model.type=e},onInvoice:function(){var e=this;this.showInvoice=!this.showInvoice,this.$nextTick((function(){e.showInvoice&&(e.invoiceForm.model.type="person",e.$refs.invoiceRef.setRules(e.invoiceForm.rules))}))},cancelInvoice:function(){var e=this;this.selectedInvoice="不开具发票",Object.keys(this.invoiceForm.model).map((function(t){return e.invoiceForm.model[t]=""})),this.showInvoice=!1},saveInvoice:function(){var e=this;this.$refs.invoiceRef.validate((function(t){t&&("company"!==e.invoiceType||e.invoiceForm.model.tax_no||e.$u.toast("请输入纳税人识别号"),e.selectedInvoice=e.invoiceForm.model.header_name,e.showInvoice=!1)}))},init:function(){return e.showLoading({title:"加载中...",mask:!0}),Promise.all([this.getDefaultAddress(),this.initDate(),this.getCoupons()]).then((function(){e.hideLoading()}))},jump:function(e,t){this.$Router.push({path:e,query:t})},initDate:function(){var e={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},t=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00"],o=(new Date).getTime(),r=this.$u.timeFormat(o),n=this.$u.timeFormat(o+864e5),i=this.$u.timeFormat(o+1728e5),s=e[(new Date).getDay()],c=e[new Date(o+864e5).getDay()],u=e[new Date(o+1728e5).getDay()];var a=[{title:"今天（"+s+"）",value:r,timeRange:function(){var e=(new Date).getHours();return t.filter((function(t){return t.split(":")[0]>e}))}()},{title:"明天（"+c+"）",value:n,timeRange:t},{title:"后天（"+u+"）",value:i,timeRange:t}];0===a[0].timeRange.length&&a.shift(),this.checkTime=a},check:function(e,t){"day"==e&&(this.checkDayCur=t),"time"==e&&(this.checkTimeCur=t,this.checkTimeId=this.checkTime[this.checkDayCur].timeRange[t].split(":")[0])},getCurGoodsExpress:function(e){var t,o=a(this.goodsList);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(r.goods_id==e.goods_id&&e.sku_price_id==r.sku_price_id)return this.expressTypeMap[r.dispatch_type]}}catch(n){o.e(n)}finally{o.f()}},getLocation:function(){var t=this;return(0,i.default)(n.default.mark((function o(){var r;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,new u.default("userLocation").check();case 2:r=o.sent,r&&e.getLocation({type:"gcj02",success:function(e){t.lng=e.longitude,t.lat=e.latitude,t.getStoreAddress()},fail:function(e){console.log("确认订单自提位置：",e)}});case 4:case"end":return o.stop()}}),o)})))()},getStoreAddress:function(){var e=this;e.$http("goods.storeAddress",{id:e.currentGoodsId,latitude:e.lat,longitude:e.lng}).then((function(t){1==t.code&&(e.storeInfo=t.data.data[0],e.storeList=t.data.data)}))},getPre:function(){var e=this;e.$http("order.pre",{goods_list:e.goodsList,from:e.from,address_id:e.addressId,coupons_id:e.couponId,order_type:e.orderType,buy_type:e.grouponBuyType,groupon_id:e.grouponId}).then((function(t){t.data&&(e.orderPre=t.data,e.perGoodsList=t.data.new_goods_list,e.totalNum=0,e.perGoodsList.map((function(t){t.selType=t.dispatch_type,e.totalNum+=t.goods_num,e.goodsList.forEach((function(e){t.goods_id==e.goods_id&&t.sku_price_id==e.sku_price_id&&(e.dispatch_type=t.dispatch_type,t.store_id&&(e.store_id=t.store_id))}))})))}))},subOrder:function(){var e=this;e.isDisabled=!0,e.$http("order.createOrder",{goods_list:e.goodsList,from:e.from,address_id:e.addressId,coupons_id:e.couponId,remark:e.remark,order_type:e.orderType,buy_type:e.grouponBuyType,groupon_id:e.grouponId,invoice:Number(e.orderPre.invoice_amount)&&"不开具发票"!==e.selectedInvoice?h(h({},e.invoiceForm.model),{},{amount:e.orderPre.invoice_amount}):{}},"提交中...").then((function(t){e.isDisabled=!1,1===t.code&&(e.getCartList(),e.$Router.replace({path:t.data.status>0?"/pages/order/payment/result":"/pages/order/payment/method",query:{orderId:t.data.id,payState:t.data.status>0?"success":"paying",orderType:"goods"}}))}))},getDefaultAddress:function(){var e=this;this.$http("address.defaults",{},"",!1).then((function(t){1===t.code&&t.data&&(e.addressData=t.data,e.addressId=t.data.id),e.getPre()}))},getCoupons:function(){var e=this;e.$http("order.coupons",{goods_list:e.goodsList,from:e.from,address_id:e.addressId,coupons_id:e.couponId,order_type:e.orderType}).then((function(t){1===t.code&&(e.couponList=t.data)}))},selectCoupon:function(e){this.couponId=e>=0?this.couponList[e].user_coupons_id:0,this.getPre()},onSelExpressType:function(e){var t=this;return(0,i.default)(n.default.mark((function o(){return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:t.showExpressType=!0,t.inExpressType=e.detail.dispatch_type_arr,t.currentGoodsId=e.goods_id,t.currentSkuId=e.sku_price_id,t.goodsList.forEach((function(e){e.goods_id==t.currentGoodsId&&t.currentSkuId==e.sku_price_id&&(t.expressTypeCur=e.dispatch_type,t.selfPhone=e.dispatch_phone?e.dispatch_phone:t.addressData&&t.addressData.phone,t.checkDayCur=e.checkDayCur?e.checkDayCur:0,t.checkTimeCur=e.checkTimeCur?e.checkTimeCur:0,"selfetch"==t.expressTypeCur&&(!t.lat&&t.getLocation(),t.storeList.forEach((function(o){e.store_id==o.id&&(t.storeInfo=o)})),t.selfPhone=e.dispatch_phone?e.dispatch_phone:t.addressData&&t.addressData.phone))}));case 5:case"end":return o.stop()}}),o)})))()},hideExpressType:function(){this.showExpressType=!1,this.changeGoodsList()},saveExpressType:function(){if("selfetch"===this.expressTypeCur){if(!this.storeInfo)return this.$u.toast("暂无自提点，请选择其他配送方式"),!1;if(!this.isProtocol)return this.$u.toast("请先勾选门店协议"),!1}this.showExpressType=!1,this.changeGoodsList(),this.getPre()},changeGoodsList:function(){var e=this;this.goodsList.forEach((function(t){if(t.goods_id==e.currentGoodsId&&e.currentSkuId==t.sku_price_id){if(t.dispatch_type=e.expressTypeCur,t.dispatch_phone=e.selfPhone,t.dispatch_date=e.checkTime[e.checkDayCur].value+" "+e.checkTime[e.checkDayCur].timeRange[e.checkTimeCur]+":00","selfetch"==e.expressTypeCur){if(!e.storeInfo)return e.$u.toast("暂无自提点，请选择其他配送方式"),!1;t.store_id=e.storeInfo.id}t.checkDayCur=e.checkDayCur,t.checkTimeCur=e.checkTimeCur}}))},changeExpressType:function(e){this.expressTypeCur=e,this.getFocus=!1,"selfetch"===e&&!this.lat&&this.getLocation()},checkProtocol:function(){this.isProtocol=!this.isProtocol},checkExpressTime:function(e){switch(e){case"store":this.checkType="配送";break;case"selfetch":this.checkType="自提";break;default:this.checkType="自提"}this.showCheckTime=!this.showCheckTime}})};t.default=l}).call(this,o("df3c")["default"])},3317:function(e,t,o){"use strict";o.r(t);var r=o("6dbc"),n=o("d3f4");for(var i in n)["default"].indexOf(i)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(i);o("9b2f");var s=o("828b"),c=Object(s["a"])(n["default"],r["b"],r["c"],!1,null,"65e0aa0c",null,!1,r["a"],void 0);t["default"]=c.exports},5996:function(e,t,o){"use strict";(function(e,t){var r=o("47a9");o("7ea0");r(o("3240"));var n=r(o("3317"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(n.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},"5fb7":function(e,t,o){},"6dbc":function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return r}));var r={shoproMiniCard:function(){return o.e("components/shopro-mini-card/shopro-mini-card").then(o.bind(null,"b3a4"))},uCollapse:function(){return o.e("node-modules/uview-ui/components/u-collapse/u-collapse").then(o.bind(null,"07bb"))},uCollapseItem:function(){return o.e("node-modules/uview-ui/components/u-collapse-item/u-collapse-item").then(o.bind(null,"1b78"))},uPopup:function(){return o.e("node-modules/uview-ui/components/u-popup/u-popup").then(o.bind(null,"e07b"))},uForm:function(){return o.e("node-modules/uview-ui/components/u-form/u-form").then(o.bind(null,"91c9"))},uFormItem:function(){return Promise.all([o.e("common/vendor"),o.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(o.bind(null,"3f82"))},uInput:function(){return Promise.all([o.e("common/vendor"),o.e("node-modules/uview-ui/components/u-input/u-input")]).then(o.bind(null,"0576"))},uCheckbox:function(){return o.e("node-modules/uview-ui/components/u-checkbox/u-checkbox").then(o.bind(null,"c24b"))}},n=function(){var e=this,t=e.$createElement,o=(e._self._c,e.__map(e.perGoodsList,(function(t,o){var r=e.__get_orig(t),n=e.getCurGoodsExpress(t);return{$orig:r,m0:n}}))),r=e.perGoodsList.length,n=r?e.orderPre.activity_discount_infos&&e.orderPre.activity_discount_infos.length&&Number(e.orderPre.activity_discount_money):null,i=r?Number(e.orderPre.dispatch_discount_money):null,s=r?Number(e.orderPre.dispatch_discount_money):null,c=r?Number(e.orderPre.dispatch_amount)-Number(e.orderPre.dispatch_discount_money)||"0.00":null,u=r?e.orderPre&&Number(e.orderPre.invoice_amount):null,a=e.__map(e.expressType,(function(t,o){var r=e.__get_orig(t),n=e.inExpressType.includes(t.value);return{$orig:r,g2:n}})),d=e.checkTime[e.checkDayCur].timeRange.length,p=d>0?e.__map(e.checkTime[e.checkDayCur].timeRange,(function(t,o){var r=e.__get_orig(t),n=t.split(":");return{$orig:r,g4:n}})):null;e._isMounted||(e.e0=function(t){e.showInvoice=!1},e.e1=function(t){e.showExpressType=!1},e.e2=function(t){e.showCheckTime=!1}),e.$mp.data=Object.assign({},{$root:{l0:o,g0:r,g1:n,m1:i,m2:s,m3:c,m4:u,a0:{"font-size":"28rpx","font-weight":"600",color:"#595959","padding-left":"20rpx"},l1:a,g3:d,l2:p}})},i=[]},"9b2f":function(e,t,o){"use strict";var r=o("5fb7"),n=o.n(r);n.a},d3f4:function(e,t,o){"use strict";o.r(t);var r=o("153d"),n=o.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){o.d(t,e,(function(){return r[e]}))}(i);t["default"]=n.a}},[["5996","common/runtime","common/vendor"]]]);