(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/address/edit"],{"2fc2":function(e,t,n){"use strict";n.r(t);var r=n("3826"),o=n("f95f");for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("40d6");var i=n("828b"),s=Object(i["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},3826:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var r={uForm:function(){return n.e("node-modules/uview-ui/components/u-form/u-form").then(n.bind(null,"91c9"))},uFormItem:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(n.bind(null,"3f82"))},uInput:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-input/u-input")]).then(n.bind(null,"0576"))},uSwitch:function(){return n.e("node-modules/uview-ui/components/u-switch/u-switch").then(n.bind(null,"bf62"))},uSelect:function(){return n.e("node-modules/uview-ui/components/u-select/u-select").then(n.bind(null,"3d19"))}},o=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.showSelect=!0})},a=[]},"40d6":function(e,t,n){"use strict";var r=n("7d7b"),o=n.n(r);o.a},4445:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n("7eb4")),a=r(n("34cf")),i=r(n("ee10")),s=r(n("af34")),c=r(n("7ca3")),d=n("e703"),u=r(n("a25c"));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h={components:{},data:function(){var e=this;return{showSelect:!1,addressAreaList:[],addressId:0,labelStyle:{"font-size":"28rpx","font-weight":"600",color:"#595959"},model:{id:0,consignee:"",phone:"",area_text:"",address:"",is_default:!1,latitude:"",longitude:""},rules:{phone:[{required:!0,message:"请输入收货人手机号",trigger:["change","blur"]},{validator:function(t,n,r){return e.$u.test.mobile(n)},message:"手机号码不正确",trigger:["change","blur"]}],consignee:[{required:!0,message:"请填写收货人姓名",trigger:["change","blur"]}],area_text:[{required:!0,message:"请选择地区",trigger:["change","blur"]}],address:[{required:!0,message:"请输入详细地址",trigger:["change","blur"]}]},errorType:["message"],chooseAddress:"点击选择地理位置"}},computed:{},onReady:function(){this.$refs.uForm.setRules(this.rules)},onLoad:function(){this.getArea(),this.addressId=this.$Route.query.id?this.$Route.query.id:0,e.setNavigationBarTitle({title:this.addressId?"编辑收货地址":"添加收货地址"}),this.addressId&&this.getAddressInfo(),this.$Route.query.addressData&&this.wxAddressInit()},methods:{getArea:function(){var e=this;this.$http("address.area").then((function(t){if(1===t.code){var n=t.data,r=n.provinceData,o=n.cityData,a=n.areaData;r.forEach((function(t,n){var r;e.addressAreaList.push(f(f({},t),{},{children:[]})),(r=e.addressAreaList[n].children).push.apply(r,(0,s.default)(o[n])),e.addressAreaList[n].children.forEach((function(e,t){var r;e["children"]=[],(r=e.children).push.apply(r,(0,s.default)(a[n][t]))}))}))}}))},wxAddressInit:function(){var e=this.$Route.query.addressData;this.model.id=0,this.model.consignee=e.userName,this.model.phone=e.telNumber,this.model.area_text="".concat(e.provinceName,"-").concat(e.cityName,"-").concat(e.countyName),this.model.address=e.detailInfo.replace(/%20/g,""),this.model.is_default=!1},regionConfirm:function(e){this.model.area_text="".concat(e[0].label,"-").concat(e[1].label,"-").concat(e[2].label)},getLocation:function(){var t=this;return(0,i.default)(o.default.mark((function n(){var r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,new u.default("userLocation").check();case 2:r=n.sent,r&&e.chooseLocation({success:function(e){t.model.latitude=e.latitude,t.model.longitude=e.longitude,t.getLocationInfo()},fail:function(e){console.log(e)}});case 4:case"end":return n.stop()}}),n)})))()},getLocationInfo:function(){var t=this;return(0,i.default)(o.default.mark((function n(){var r,i,s,c;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.chooseAddress="定位中...",n.next=3,e.request({url:"https://restapi.amap.com/v3/geocode/regeo?location=".concat(t.model.longitude,",").concat(t.model.latitude,"&key=").concat(d.MAP_KEY)});case 3:r=n.sent,i=(0,a.default)(r,2),i[0],s=i[1],"1"===s.data.status?(c=s.data.regeocode.addressComponent,t.chooseAddress=s.data.regeocode.formatted_address,t.model.area_text="".concat(c.province,"-").concat(c.city.length?c.city:c.province,"-").concat(c.district),t.model.address=s.data.regeocode.formatted_address.replace("".concat(c.province).concat(c.city).concat(c.district),"")):console.log("%c逆地址解析失败，请检查是否在env中配置地图key","color:green;background:yellow");case 8:case"end":return n.stop()}}),n)})))()},submit:function(){var e=this;this.$refs.uForm.validate((function(t){t?e.editAddress():console.log("验证失败")}))},editAddress:function(){var e=this;e.$http("address.edit",f(f({},e.model),{},{id:e.addressId}),"保存中...").then((function(t){1===t.code&&e.$Router.back()}))},getAddressInfo:function(){var e=this;this.$http("address.info",{id:e.$Route.query.id}).then((function(t){if(1===t.code){var n=t.data;e.addressId=n.id,e.model.area_text="".concat(n.province_name,"-").concat(n.city_name,"-").concat(n.area_name),e.model.is_default="1"===n.is_default,e.model.address=n.address,e.model.phone=n.phone,e.model.consignee=n.consignee}}))},deleteAddress:function(){var e=this;e.$http("address.del",{id:e.addressId},"删除中...").then((function(t){1===t.code&&e.$Router.back()}))}}};t.default=h}).call(this,n("df3c")["default"])},"7d7b":function(e,t,n){},"8ade":function(e,t,n){"use strict";(function(e,t){var r=n("47a9");n("7ea0");r(n("3240"));var o=r(n("2fc2"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},f95f:function(e,t,n){"use strict";n.r(t);var r=n("4445"),o=n.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a}},[["8ade","common/runtime","common/vendor"]]]);